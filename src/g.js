(()=>{var t,e,i=()=>{},n="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);";function o(t,e){let i=e.parentNode;if(t.setAttribute("data-kontra",""),i){let n=i.querySelector("[data-kontra]:last-of-type")||e;i.insertBefore(t,n.nextSibling)}else document.body.appendChild(t)}function s(t,e){let i=t.indexOf(e);if(-1!=i)return t.splice(i,1),!0}var h={};function a(t,e){h[t]=h[t]||[],h[t].push(e)}function l(t,...e){(h[t]||[]).map((t=>t(...e)))}var d={get:(t,e)=>"_proxy"==e||i};function r(){return t}function c(){return e}var u=/(jpeg|jpg|gif|png|webp)$/,x=/(wav|mp3|ogg|aac)$/,y=/^\//,g=/\/$/,f=new WeakMap,_="",p="",w="";function m(t,e){return new URL(t,e).href}function v(t,e){return[t.replace(g,""),t?e.replace(y,""):e].filter((t=>t)).join("/")}function b(t){return t.split(".").pop()}function M(t){let e=t.replace("."+b(t),"");return 2==e.split("/").length?e.replace(y,""):e}var j={},k={},E={};function O(){window.__k||(window.__k={dm:f,u:m,d:E,i:j})}function A(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}function Y(t,e,i){return Math.min(Math.max(t,i),e)}function P(t,e){return[t,e]=[t,e].map((t=>C(t))),t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function C(t){let{x:e=0,y:i=0,width:n,height:o}=t.world||t;return t.mapwidth&&(n=t.mapwidth,o=t.mapheight),t.anchor&&(e-=n*t.anchor.x,i-=o*t.anchor.y),n<0&&(e+=n,n*=-1),o<0&&(i+=o,o*=-1),{x:e,y:i,width:n,height:o}}var L=class{constructor(t=0,e=0,i={}){null!=t.x?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new L(this.x+t.x,this.y+t.y,this)}subtract(t){return new L(this.x-t.x,this.y-t.y,this)}scale(t){return new L(this.x*t,this.y*t)}normalize(t=this.length()||1){return new L(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,e,i,n){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Y(this._a,this._d,t):t}set y(t){this._y=this._c?Y(this._b,this._e,t):t}};function X(){return new L(...arguments)}var S=class{constructor(t){return this.init(t)}init(t={}){this.position=X(),this.velocity=X(),this.acceleration=X(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}},F=class extends S{init({width:t=0,height:e=0,context:i=c(),render:n=this.draw,update:o=this.advance,children:s=[],anchor:h={x:0,y:0},opacity:l=1,rotation:d=0,scaleX:r=1,scaleY:u=1,...x}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:h,opacity:l,rotation:d,scaleX:r,scaleY:u,...x}),this._di=!0,this._uw(),this.addChild(s),this._rf=n,this._uf=o,a("init",(()=>{this.context??=c()}))}update(t){this._uf(t),this.children.map((e=>e.update&&e.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(e||i)&&t.translate(e,i),this.context.globalAlpha=this.opacity,this._rf(),(e||i)&&t.translate(-e,-i),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wr:n=0,_wsx:o=1,_wsy:s=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=i*this.opacity,this._wsx=o*this.scaleX,this._wsy=s*this.scaleY,this._wx=this._wx*o,this._wy=this._wy*s,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=n+this.rotation;let{x:h,y:a}=function(t,e){let i=Math.sin(e),n=Math.cos(e);return{x:t.x*n-t.y*i,y:t.x*i+t.y*n}}({x:this._wx,y:this._wy},n);this._wx=h,this._wy=a,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map((t=>{this.children.push(t),t.parent=this,t._pc=t._pc||i,t._pc()}))}removeChild(...t){t.flat().map((t=>{s(this.children,t)&&(t.parent=null,t._pc())}))}get opacity(){return this._opa}set opacity(t){this._opa=Y(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}},I=class extends F{init({image:t,width:e=(t?t.width:void 0),height:i=(t?t.height:void 0),...n}={}){super.init({image:t,width:e,height:i,...n})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation?.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){super.advance(t),this.currentAnimation?.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}};function N(){return new I(...arguments)}var D=/(\d+)(\w+)/;var T=class extends F{init({text:t="",textAlign:e="",lineHeight:i=1,font:n=c()?.font,...o}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:n,...o}),this.context&&this._p(),a("init",(()=>{this.font??=c().font,this._p()}))}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=function(t){if(!t)return{computed:0};let e=t.match(D),i=+e[1];return{size:i,unit:e[2],computed:i}}(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,e=[this.text];if(t.font=this.font,e=this.text.split("\n"),this._fw&&e.map((e=>{let i=e.split(" "),n=i.shift(),o=n;i.map((e=>{o+=" "+e,t.measureText(o).width>this._fw&&(this._s.push(n),o=e),n=o})),this._s.push(o)})),!this._s.length&&this.text.includes("\n")){let i=0;e.map((e=>{this._s.push(e),i=Math.max(i,t.measureText(e).width)})),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;e=this.textAlign||("rtl"==i.canvas.dir?"right":"left"),t="right"==e?this.width:"center"==e?this.width/2|0:0,this._s.map(((n,o)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,this.strokeColor&&(i.strokeStyle=this.strokeColor,i.lineWidth=this.lineWidth??1,i.strokeText(n,t,this._fs*this.lineHeight*o)),i.fillText(n,t,this._fs*this.lineHeight*o)}))}};var H=new WeakMap,U={},W={},B={0:"left",1:"middle",2:"right"};function R(t=r()){return H.get(t)}function q(t,e){let{x:i,y:n,width:o,height:s}=C(t);do{i-=t.sx||0,n-=t.sy||0}while(t=t.parent);let h=e.x-Math.max(i,Math.min(e.x,i+o)),a=e.y-Math.max(n,Math.min(e.y,n+s));return h*h+a*a<e.radius*e.radius}function z(t,e){return parseFloat(t.getPropertyValue(e))||0}function $(t){let e=null!=t.button?B[t.button]:"left";W[e]=!0,Q(t,"onDown")}function K(t){let e=null!=t.button?B[t.button]:"left";W[e]=!1,Q(t,"onUp")}function V(t){Q(t,"onOver")}function G(t){H.get(t.target)._oo=null,W={}}function J(t,e,i){let n=function(t){let e=t._lf.length?t._lf:t._cf;for(let i=e.length-1;i>=0;i--){let n=e[i];if(n.collidesWithPointer?n.collidesWithPointer(t):q(n,t))return n}}(t);n&&n[e]&&n[e](i),U[e]&&U[e](i,n),"onOver"==e&&(n!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(i),t._oo=n)}function Q(t,e){t.preventDefault();let i=t.target,n=H.get(i),{scaleX:o,scaleY:s,offsetX:h,offsetY:a}=function(t){let{canvas:e,_s:i}=t,n=e.getBoundingClientRect(),o="none"!=i.transform?i.transform.replace("matrix(","").split(","):[1,1,1,1],s=parseFloat(o[0]),h=parseFloat(o[3]),a=(z(i,"border-left-width")+z(i,"border-right-width"))*s,l=(z(i,"border-top-width")+z(i,"border-bottom-width"))*h,d=(z(i,"padding-left")+z(i,"padding-right"))*s,r=(z(i,"padding-top")+z(i,"padding-bottom"))*h;return{scaleX:(n.width-a-d)/e.width,scaleY:(n.height-l-r)/e.height,offsetX:n.left+(z(i,"border-left-width")+z(i,"padding-left"))*s,offsetY:n.top+(z(i,"border-top-width")+z(i,"padding-top"))*h}}(n);t.type.includes("touch")?(Array.from(t.touches).map((({clientX:t,clientY:e,identifier:i})=>{let l=n.touches[i];l||(l=n.touches[i]={start:{x:(t-h)/o,y:(e-a)/s}},n.touches.length++),l.changed=!1})),Array.from(t.changedTouches).map((({clientX:i,clientY:d,identifier:r})=>{let c=n.touches[r];c.changed=!0,c.x=n.x=(i-h)/o,c.y=n.y=(d-a)/s,J(n,e,t),l("touchChanged",t,n.touches),"onUp"==e&&(delete n.touches[r],n.touches.length--,n.touches.length||l("touchEnd"))}))):(n.x=(t.clientX-h)/o,n.y=(t.clientY-a)/s,J(n,e,t))}function Z(t){return!!W[t]}var tt=class extends I{init({padX:t=0,padY:e=0,text:s,disabled:h=!1,onDown:a,onUp:l,...d}={}){super.init({padX:t,padY:e,...d}),this.textNode=function(){return new T(...arguments)}({...s,context:this.context}),this.width||(this.width=this.textNode.width,this.height=this.textNode.height),function(...t){t.flat().map((t=>{let e=t.context?t.context.canvas:r(),i=H.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t._r||(t._r=t.render,t.render=function(){i._cf.push(this),this._r()},i._o.push(t))}))}(this),this.addChild(this.textNode),this._od=a||i,this._ou=l||i;let c=this._dn=document.createElement("button");c.style=n,c.textContent=this.text,h&&this.disable(),c.addEventListener("focus",(()=>this.focus())),c.addEventListener("blur",(()=>this.blur())),c.addEventListener("keydown",(t=>this._kd(t))),c.addEventListener("keyup",(t=>this._ku(t))),o(c,this.context.canvas),this._uw(),this._p()}get text(){return this.textNode.text}set text(t){this._d=!0,this.textNode.text=t}destroy(){this._dn.remove()}_p(){this.text!=this._dn.textContent&&(this._dn.textContent=this.text),this.textNode._p();let t=this.textNode.width+2*this.padX,e=this.textNode.height+2*this.padY;this.width=Math.max(t,this.width),this.height=Math.max(e,this.height),this._uw()}render(){this._d&&this._p(),super.render()}enable(){this.disabled=this._dn.disabled=!1,this.onEnable()}disable(){this.disabled=this._dn.disabled=!0,this.onDisable()}focus(){this.disabled||(this.focused=!0,document.activeElement!=this._dn&&this._dn.focus(),this.onFocus())}blur(){this.focused=!1,document.activeElement==this._dn&&this._dn.blur(),this.onBlur()}onOver(){this.disabled||(this.hovered=!0)}onOut(){this.hovered=!1}onEnable(){}onDisable(){}onFocus(){}onBlur(){}onDown(){this.disabled||(this.pressed=!0,this._od())}onUp(){this.disabled||(this.pressed=!1,this._ou())}_kd(t){"Enter"!=t.code&&"Space"!=t.code||this.onDown()}_ku(t){"Enter"!=t.code&&"Space"!=t.code||this.onUp()}};function et(){return new tt(...arguments)}function it(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}function nt({fps:t=60,clearCanvas:e=!0,update:n=i,render:o,context:s=c(),blur:h=!1}={}){if(!o)throw Error("You must provide a render() function");let d,r,u,x,y,g=0,f=1e3/t,_=1/t,p=e?it:i,w=!0;function m(){if(r=requestAnimationFrame(m),w&&(u=performance.now(),x=u-d,d=u,!(x>1e3))){for(l("tick"),g+=x;g>=f;)y.update(_),g-=f;p(y.context),y.render()}}return h||(window.addEventListener("focus",(()=>{w=!0})),window.addEventListener("blur",(()=>{w=!1}))),a("init",(()=>{y.context??=c()})),y={update:n,render:o,isStopped:!0,context:s,start(){d=performance.now(),this.isStopped=!1,requestAnimationFrame(m)},stop(){this.isStopped=!0,cancelAnimationFrame(r)},_frame:m,set _last(t){d=t}},y}var ot={},st={},ht={},at={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function lt(t=i,e){t._pd&&e.preventDefault(),t(e)}function dt(t){let e=at[t.code],i=ot[e];ht[e]=!0,lt(i,t)}function rt(t){let e=at[t.code],i=st[e];ht[e]=!1,lt(i,t)}function ct(){ht={}}function ut(t){return!![].concat(t).some((t=>ht[t]))}function xt(t){let e=[];return t._dn?e.push(t._dn):t.children&&t.children.map((t=>{e=e.concat(xt(t))})),e}var yt=class{constructor({id:t,name:e=t,objects:i=[],context:s=c(),cullObjects:h=!0,cullFunction:l=P,sortFunction:d,...r}){this._o=[],Object.assign(this,{id:t,name:e,context:s,cullObjects:h,cullFunction:l,sortFunction:d,...r});let u=this._dn=document.createElement("section");u.tabIndex=-1,u.style=n,u.id=t,u.setAttribute("aria-label",e);let x=this;this.camera=new class extends F{set x(t){x.sx=t-this.centerX,super.x=t}get x(){return super.x}set y(t){x.sy=t-this.centerY,super.y=t}get y(){return super.y}}({context:s,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(i),this._i=()=>{this.context??=c();let t=this.context.canvas,{width:e,height:i}=t,n=e/2,s=i/2;Object.assign(this.camera,{centerX:n,centerY:s,x:n,y:s,width:e,height:i}),this._dn.isConnected||o(this._dn,t)},this.context&&this._i(),a("init",this._i)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map((t=>{this._o.push(t),t.parent=this,xt(t).map((t=>{this._dn.appendChild(t)}))}))}remove(...t){t.flat().map((t=>{s(this._o,t),t.parent=null,xt(t).map((t=>{o(t,this.context)}))}))}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find((t=>t.focus));t?t.focus():this._dn.focus(),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){var t,e;t="init",e=this._i,h[t]=(h[t]||[]).filter((t=>t!=e)),this._dn.remove(),this._o.map((t=>t.destroy&&t.destroy()))}lookAt(t){let{x:e,y:i}=t.world||t;this.camera.x=e,this.camera.y=i}update(t){this.hidden||this._o.map((e=>e.update&&e.update(t)))}_rf(){let{_o:t,context:e,_sx:i,_sy:n,camera:o,sortFunction:s,cullObjects:h,cullFunction:a}=this;e.translate(i,n);let l=t;h&&(l=l.filter((t=>a(o,t)))),s&&l.sort(s),l.map((t=>t.render&&t.render()))}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:i,y:n,centerX:o,centerY:s}=e;t.save(),this._sx=o-i,this._sy=s-n,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}};function gt(){return new yt(...arguments)}var{canvas:ft,context:_t}=function(i,{contextless:n=!1}={}){if(t=document.getElementById(i)||i||document.querySelector("canvas"),n&&(t=t||new Proxy({},d)),!t)throw Error("You must provide a canvas element for the game");return(e=t.getContext("2d")||new Proxy({},d)).imageSmoothingEnabled=!1,l("init"),{canvas:t,context:e}}();!function(){let t;for(t=0;t<26;t++)at["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)at["Digit"+t]=at["Numpad"+t]=""+t;window.addEventListener("keydown",dt),window.addEventListener("keyup",rt),window.addEventListener("blur",ct)}(),function({radius:t=5,canvas:e=r()}={}){let i=H.get(e);if(!i){let n=window.getComputedStyle(e);i={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:n},H.set(e,i)}e.addEventListener("mousedown",$),e.addEventListener("touchstart",$),e.addEventListener("mouseup",K),e.addEventListener("touchend",K),e.addEventListener("touchcancel",K),e.addEventListener("blur",G),e.addEventListener("mousemove",V),e.addEventListener("touchmove",V),i._t||(i._t=!0,a("tick",(()=>{i._lf.length=0,i._cf.map((t=>{i._lf.push(t)})),i._cf.length=0})))}();var pt,wt,mt,vt,bt,Mt=576,jt=576,kt=ft.width/2,Et=ft.height/2,Ot=.5,At=.7,Yt=.15,Pt=.1,Ct=3.5,Lt=1.45,Xt=.8,St=4.5,Ft=null;function It(t){let e=[];for(let i=0;i<t.length;i++)if(t[i][0]<=Mt&&t[i][1]<=jt&&t[i][0]>=0&&t[i][1]>=0){let n=N({x:t[i][0],y:t[i][1],width:32,height:32,color:"white"});e.push(n)}else"w"==t[i][0]&&(Ft=N({x:t[i][1][0],y:t[i][1][1],width:32,height:32,color:"yellow"}));return e}function Nt(t,e,i,n){return{relative_x:t+(i-=kt),relative_y:e+(n-=Et)}}function Dt(t,e,i,n){return Math.sqrt((i-t)**2+(n-e)**2)}function Tt(t,e){return t<0||e<0||t>Mt||e>jt}(function(...t){return O(),Promise.all(t.map((t=>{let e=b([].concat(t)[0]);return e.match(u)?function(t){return O(),new Promise(((e,i)=>{let n,o,s;if(n=v(_,t),j[n])return e(j[n]);o=new Image,o.onload=function(){s=m(n,window.location.href),j[M(t)]=j[n]=j[s]=this,l("assetLoaded",this,t),e(this)},o.onerror=function(){i("Unable to load image "+n)},o.src=n}))}(t):e.match(x)?function(t){return new Promise(((e,i)=>{let n,o,s,h,a=t;return n=new Audio,o=function(t){return{wav:t.canPlayType('audio/wav; codecs="1"'),mp3:t.canPlayType("audio/mpeg;"),ogg:t.canPlayType('audio/ogg; codecs="vorbis"'),aac:t.canPlayType("audio/aac;")}}(n),(t=[].concat(t).reduce(((t,e)=>t||(o[b(e)]?e:null)),0))?(s=v(p,t),k[s]?e(k[s]):(n.addEventListener("canplay",(function(){h=m(s,window.location.href),k[M(t)]=k[s]=k[h]=this,l("assetLoaded",this,t),e(this)})),n.onerror=function(){i("Unable to load audio "+s)},n.src=s,void n.load())):i("cannot play any of the audio formats provided "+a)}))}(t):function(t){let e,i;return O(),e=v(w,t),E[e]?Promise.resolve(E[e]):fetch(e).then((t=>{if(!t.ok)throw t;return t.clone().json().catch((()=>t.text()))})).then((n=>(i=m(e,window.location.href),"object"==typeof n&&f.set(n,i),E[M(t)]=E[e]=E[i]=n,l("assetLoaded",n,t),n)))}(t)})))})("assets/images/player.png","assets/images/enemy1.png").then((function(t){let e=function(t){let e=[[]];for(let i=0;i<17;i++)for(let n=0;n<=17;n++)1==t[i][n]&&e.push([32*n,32*i]),2==t[i][n]&&e.push(["w",[32*n,32*i]]);return e}([[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,1],[1,1,1,1,1,1,1,0,0,0,1,1,0,1,1,0,1],[1,0,0,0,1,1,1,0,0,0,1,0,0,0,0,0,1],[1,0,1,0,1,1,1,1,1,0,1,0,0,0,1,1,1],[1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,0,1],[1,0,0,0,1,0,1,1,1,1,1,0,1,0,1,0,1],[1,1,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1],[1,0,1,0,0,1,1,1,0,1,1,1,1,0,1,1,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,0,1,1,1,0,1,0,1,1,1,1,1,0,0,0,1],[1,0,1,0,0,0,1,0,0,0,0,0,1,0,1,0,1],[1,0,1,0,0,0,1,1,1,1,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,1,1,1,0,0,1,0,1,0,1],[1,0,1,0,1,0,1,0,0,0,1,1,1,0,1,0,1],[1,0,0,0,1,0,0,0,1,0,0,1,0,0,1,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]);console.log("coords ",e);let i=[],n=[];i=It(e);let o=N({lives:4,x:52,y:52,image:t[0],attack_delay:Ot,anchor:{x:.5,y:.5},time_alive:0,alive:function(){return this.lives>0},shoot:function(t,e){if(this.attack_delay<=0){let i=A(this,{x:t,y:e}),n=St*Math.cos(i),o=St*Math.sin(i),s=15*Math.cos(i),h=15*Math.sin(i);pt=N({x:this.x+s,y:this.y+h,dx:n,dy:o,width:5,height:10,anchor:{x:.5,y:.5},rotation:i+Math.PI/2,color:"red"}),a.add(pt),this.attack_delay=Ot}}}),s=N({lives:4,direction:4,dx:1,dy:0,x:322,y:50,image:t[1],attack_delay:At,ray_delay:Yt,anchor:{x:.5,y:.5},time_alive:0,alive:function(){return this.lives>0},shoot_rays:function(){let t=this.direction*Math.PI/2,e=t-Math.PI/2.5,i=t+Math.PI/2.5;mt=N({x:this.x,y:this.y,dx:-3.5*Math.cos(e)*.9,dy:-3.5*Math.sin(e)*.9,color:"red",width:5,height:5,time_alive:0,collided:!1,changed:!1}),vt=N({x:this.x,y:this.y,dx:-3.5*Math.cos(t)*1,dy:-3.5*Math.sin(t)*1,color:"blue",width:5,height:5,time_alive:0,collided:!1,changed:!1}),bt=N({x:this.x,y:this.y,dx:-3.5*Math.cos(i)*.9,dy:-3.5*Math.sin(i)*.9,color:"yellow",width:5,height:5,time_alive:0,collided:!1,changed:!1}),a.add(mt),a.add(vt),a.add(bt)},shoot:function(){if(this.attack_delay<=0){let t=A(this,{x:o.x,y:o.y}),e=St*Math.cos(t),i=St*Math.sin(t),n=15*Math.cos(t),s=15*Math.sin(t);wt=N({x:this.x+n,y:this.y+s,dx:e,dy:i,width:5,height:10,anchor:{x:.5,y:.5},rotation:t+Math.PI/2,color:"blue"}),a.add(wt),this.attack_delay=At}}}),h=N({x:0,y:0,width:544,height:544,color:"green"}),a=gt({id:"game",objects:[h,Ft,o,s,...i]}),l=0,d=0,r=0,c=0,u=[],x=[];for(let t=0;t<17;t++)for(let e=0;e<17;e++){let i=N({x:32*e,y:32*t,width:32,height:32,toggle:!1});x.push(i)}function y(){for(let t=0;t<x.length;t++)"wc"==x[t].toggle?(m=N({x:x[t].x,y:x[t].y,width:32,height:32,color:"yellow"}),x[t].color="yellow",console.log("executed 1")):"s"==x[t].toggle?(console.log("; in"),v={x:x[t].x,y:x[t].y},x[t].color="blue"):1==x[t].toggle?(console.log("executed 2"),x[t].color="white"):0==x[t].toggle&&(x[t].color=null)}let g=N({x:0,y:0,anchor:{x:.5,y:.5},color:"red",width:8,height:8}),f=gt({id:"map",objects:[h,...x,g]});f.hide();let _=N({lives:4,x:52,y:52,image:t[0],attack_delay:Ot,anchor:{x:.5,y:.5},time_alive:0,alive:function(){return this.lives>0},shoot:function(t,e){if(this.attack_delay<=0){let i=A(this,{x:t,y:e}),n=St*Math.cos(i),o=St*Math.sin(i),s=15*Math.cos(i),h=15*Math.sin(i);pt=N({x:this.x+s,y:this.y+h,dx:n,dy:o,width:5,height:10,anchor:{x:.5,y:.5},rotation:i+Math.PI/2,color:"red"}),p.add(pt),this.attack_delay=Ot}}});console.log("canvas center x",kt),console.log("canvas center y",Et);let p,w=N({lives:4,direction:2,dx:1,dy:0,x:kt,y:Et,image:t[1],attack_delay:At,ray_delay:Yt,anchor:{x:.5,y:.5},time_alive:0,alive:function(){return this.lives>0},shoot_rays:function(){let t=this.direction*Math.PI/2,e=t-Math.PI/2.5,i=t+Math.PI/2.5;mt=N({x:this.x,y:this.y,dx:-3.5*Math.cos(e)*.9,dy:-3.5*Math.sin(e)*.9,color:"red",width:5,height:5,time_alive:0,collided:!1,changed:!1}),vt=N({x:this.x,y:this.y,dx:-3.5*Math.cos(t)*1,dy:-3.5*Math.sin(t)*1,color:"blue",width:5,height:5,time_alive:0,collided:!1,changed:!1}),bt=N({x:this.x,y:this.y,dx:-3.5*Math.cos(i)*.9,dy:-3.5*Math.sin(i)*.9,color:"yellow",width:5,height:5,time_alive:0,collided:!1,changed:!1}),p.add(mt),p.add(vt),p.add(bt)},shoot:function(){if(this.attack_delay<=0){let t=A(this,{x:_.x,y:_.y}),e=St*Math.cos(t),i=St*Math.sin(t),n=15*Math.cos(t),o=15*Math.sin(t);wt=N({x:this.x+n,y:this.y+o,dx:e,dy:i,width:5,height:10,anchor:{x:.5,y:.5},rotation:t+Math.PI/2,color:"blue"}),p.add(wt),this.attack_delay=At}}}),m=null,v=null;let b=et({x:kt,y:Et-30,width:120,height:40,color:"green",anchor:{x:.5,y:.5},text:{text:"Play",color:"white",font:"20px Arial, sans-serif",anchor:{x:.5,y:.5}}}),M=et({x:kt,y:Et+30,width:120,height:40,color:"green",anchor:{x:.5,y:.5},text:{text:"Create Map",color:"white",font:"20px Arial, sans-serif",anchor:{x:.5,y:.5}}}),j=gt({id:"menu",objects:[b,M]});const k=nt({update:function(t){b.hovered?b.color="darkgreen":b.hovered||(b.color="green"),M.hovered?M.color="darkgreen":M.hovered||(M.color="green"),b.pressed&&(k.stop(),j.hide(),a.show(),Y.start()),M.pressed&&(k.stop(),j.hide(),f.show(),O.start()),j.update()},render:function(){j.render()}}),E=nt({update:function(t){if(console.log("update 1"),_.attack_delay-=t,w.attack_delay-=t,w.ray_delay-=t,_.time_alive+=t,w.time_alive+=t,mt&&(mt.time_alive+=t),vt&&(vt.time_alive+=t),bt&&(bt.time_alive+=t),p.lookAt(_),ut("w")&&(_.y-=Lt),ut("s")&&(_.y+=Lt),ut("a")&&(_.x-=Lt),ut("d")&&(_.x+=Lt),_.x>h.width-_.width&&(_.x=h.width-_.width),_.x<0&&(_.x=0),_.y>h.height-_.height&&(_.y=h.height-_.height),_.y<0&&(_.y=0),w.x>h.width-w.width&&(console.log("player2 x > background.width"),w.x=h.width-w.width),w.x<=0&&(console.log("player2 x <= 0"),w.x=1),w.y>h.height-w.height&&(console.log("player2 y > background.height"),w.y=h.height-w.height),w.y<=0&&(console.log("player2 y <= 0"),w.y=1),_.alive()||(E.stop(),alert("You lost"),window.location.reload()),(P(_,m)||ut("u"))&&(E.stop(),_.x=0,_.y=0,alert("You won"),window.location.reload()),n.forEach((function(t){if(P(_,t)&&(_.x=l,_.y=d),P(w,t)&&(console.log("player 2 collided with wall",w.x,w.y),w.time_alive<1?(w.x=Math.floor(544*Math.random())+16,w.y=Math.floor(544*Math.random())+16):(w.x=r,w.y=c)),pt&&P(pt,t)){let t=p.objects.indexOf(pt);t>-1&&p.objects.splice(t,1),pt=null}if(wt&&P(wt,t)){let t=p.objects.indexOf(wt);t>-1&&p.objects.splice(t,1),wt=null}mt&&(P(mt,t)||Tt(mt.x,mt.y))&&(mt.collided=!0),vt&&(P(vt,t)||Tt(vt.x,vt.y))&&(vt.collided=!0),bt&&(P(bt,t)||Tt(bt.x,bt.y))&&(bt.collided=!0)})),l=_.x,d=_.y,r=w.x,c=w.y,w.ray_delay<=0&&w.alive()&&(w.shoot_rays(),w.ray_delay=Yt),mt&&mt.time_alive>=Pt){let t=p.objects.indexOf(mt);t>-1&&p.objects.splice(t,1)}if(vt&&vt.time_alive>=Pt){let t=p.objects.indexOf(vt);t>-1&&p.objects.splice(t,1)}if(bt&&bt.time_alive>=Pt){let t=p.objects.indexOf(bt);t>-1&&p.objects.splice(t,1)}if(w.alive()){if(console.log("direction WAS",w.direction),mt&&mt.collided&&!mt.changed)mt.changed=!0,vt.collided&&!vt.changed&&(vt.changed=!0,bt.collided?(w.direction+=1,mt.changed=!1,vt.changed=!1):bt.collided||(w.direction+=1,mt.changed=!1,vt.changed=!1));else if(mt&&!mt.collided&&!mt.changed&&vt.collided&&!vt.changed)if(vt.changed=!0,bt.collided&&!bt.changed)bt.changed=!0,w.direction-=1,mt.changed=!1,vt.changed=!1;else if(!bt.collided){1==Math.floor(1*Math.random())?w.direction+=1:w.direction-=1,mt.changed=!1,vt.changed=!1}switch(console.log("directoin new",w.direction),w.direction>4&&(w.direction=1),w.direction<1&&(w.direction=4),w.direction){case 1:w.dx=0,w.dy=-.8;break;case 2:w.dx=Xt,w.dy=0;break;case 3:w.dx=0,w.dy=Xt;break;case 4:w.dx=-.8,w.dy=0}w.attack_delay<=0&&Dt(_.x,_.y,w.x,w.y)<90&&w.shoot()}if(Z("left")&&_.attack_delay<=0){const{x:t,y:e}=R(),{relative_x:i,relative_y:n}=Nt(_.x,_.y,t,e);_.shoot(i,n)}if(pt&&P(pt,w))if(w.alive()){w.lives-=1;let t=p.objects.indexOf(pt);if(t>-1&&p.objects.splice(t,1),pt=null,!w.alive()){let t=p.objects.indexOf(w);t>-1&&p.objects.splice(t,1)}}else{let t=p.objects.indexOf(w);t>-1&&p.objects.splice(t,1)}if(wt&&P(wt,_)){_.lives-=1;let t=p.objects.indexOf(wt);if(t>-1&&p.objects.splice(t,1),wt=null,!_.alive()){let t=p.objects.indexOf(_);t>-1&&p.objects.splice(t,1)}}if(pt&&(pt.y<0||pt.y>jt||pt.x<0||pt.x>Mt)){let t=p.objects.indexOf(pt);t>-1&&p.objects.splice(t,1),pt=null}if(wt&&(wt.y<0||wt.y>jt||wt.x<0||wt.x>Mt)){let t=p.objects.indexOf(wt);t>-1&&p.objects.splice(t,1),wt=null}p.update()},render:function(){p.render()}}),O=nt({update:function(t){console.log("update 2"),f.lookAt(g),ut("w")&&(g.y-=Ct),ut("s")&&(g.y+=Ct),ut("a")&&(g.x-=Ct),ut("d")&&(g.x+=Ct),g.x>Mt-g.width&&(g.x=Mt-g.width),g.x<0&&(g.x=0),g.y>jt-g.height&&(g.y=jt-g.height),g.y<0&&(g.y=0),ut("space")&&(O.stop(),g.x=-20,g.y=-20,x.forEach((function(t){1==t.toggle&&(u.push([t.x,t.y]),console.log("sprite x",t.x),console.log("sprite y",t.y))})),f.hide(),console.log("new map coords",u),n=It(u),function(){_.x=v.x+16,_.y=v.y+16;let t=!0;console.log("walls",n);for(let e=0;e<n.length;e++){if(!(P(w,n[e])||Dt(w.x,w.y,v.x,v.y)<100)){console.log("player2 not collided"),t=!1;break}console.log("player2 collided"),w.x=Math.floor(544*Math.random())+16,w.y=Math.floor(544*Math.random())+16,t=!0}console.log("collided = ",t),console.log("player 2 position x y",w.x,w.y),p=gt({id:"scene 3",objects:[h,m,_,w,...n]}),O.stop()}(),alert("Level created!"),p.show(),E.start());for(let t=0;t<x.length;t++)P(g,x[t])&&(ut("j")&&(x[t].toggle=!0,y()),ut("k")&&("s"==x[t].toggle&&(v=null),x[t].toggle=!1,y()),ut("l")&&("s"==x[t].toggle&&(v=null),x[t].toggle="wc",console.log("\n\n",x[t].toggle,"\n\n"),y()),ut("h")&&null==v&&(x[t].toggle="s",console.log("; toggle executed"),y()));f.update()},render:function(){f.render()}}),Y=nt({update:function(t){if(console.log("update 1"),o.attack_delay-=t,s.attack_delay-=t,s.ray_delay-=t,o.time_alive+=t,s.time_alive+=t,mt&&(mt.time_alive+=t),vt&&(vt.time_alive+=t),bt&&(bt.time_alive+=t),a.lookAt(o),ut("w")&&(o.y-=Lt),ut("s")&&(o.y+=Lt),ut("a")&&(o.x-=Lt),ut("d")&&(o.x+=Lt),o.x>h.width-o.width&&(o.x=h.width-o.width),o.x<0&&(o.x=0),o.y>h.height-o.height&&(o.y=h.height-o.height),o.y<0&&(o.y=0),o.alive()||(Y.stop(),alert("You lost"),window.location.reload()),(P(o,Ft)||ut("u"))&&(Y.stop(),o.x=0,o.y=0,alert("You won"),window.location.reload()),i.forEach((function(t){if(P(o,t)&&(o.time_alive<1&&(console.log("1 collided"),o.x=Math.floor(Math.random()*Mt),o.y=Math.floor(Math.random()*jt),o.time_alive=0),o.x=l,o.y=d),P(s,t)&&(s.time_alive<1&&(console.log("2 collided"),s.x=Math.floor(Math.random()*Mt),s.y=Math.floor(Math.random()*jt),s.time_alive=0),s.x=r,s.y=c),pt&&P(pt,t)){let t=a.objects.indexOf(pt);t>-1&&a.objects.splice(t,1),pt=null}if(wt&&P(wt,t)){let t=a.objects.indexOf(wt);t>-1&&a.objects.splice(t,1),wt=null}mt&&P(mt,t)&&(mt.collided=!0),vt&&P(vt,t)&&(vt.collided=!0),bt&&P(bt,t)&&(bt.collided=!0)})),l=o.x,d=o.y,r=s.x,c=s.y,s.ray_delay<=0&&s.alive()&&(s.shoot_rays(),s.ray_delay=Yt),mt&&mt.time_alive>=Pt){let t=a.objects.indexOf(mt);t>-1&&a.objects.splice(t,1)}if(vt&&vt.time_alive>=Pt){let t=a.objects.indexOf(vt);t>-1&&a.objects.splice(t,1)}if(bt&&bt.time_alive>=Pt){let t=a.objects.indexOf(bt);t>-1&&a.objects.splice(t,1)}if(s.alive()){if(mt&&mt.collided&&!mt.changed)mt.changed=!0,vt.collided&&!vt.changed&&(vt.changed=!0,bt.collided?(console.log("3 rays collided"),s.direction+=1,mt.changed=!1,vt.changed=!1):bt.collided||(console.log("ray left straight collided, turning right"),s.direction+=1,mt.changed=!1,vt.changed=!1));else if(mt&&!mt.collided&&!mt.changed&&vt.collided&&!vt.changed)if(vt.changed=!0,bt.collided&&!bt.changed)console.log("straight right rays collided, turning left"),bt.changed=!0,s.direction-=1,mt.changed=!1,vt.changed=!1;else if(!bt.collided){console.log("ray straight collided"),1==Math.floor(1*Math.random())?(s.direction+=1,console.log("turning right")):(s.direction-=1,console.log("turning left")),mt.changed=!1,vt.changed=!1}switch(s.direction>4&&(s.direction=1),s.direction<1&&(s.direction=4),s.direction){case 1:s.dx=0,s.dy=-.8;break;case 2:s.dx=Xt,s.dy=0;break;case 3:s.dx=0,s.dy=Xt;break;case 4:s.dx=-.8,s.dy=0}s.attack_delay<=0&&Dt(o.x,o.y,s.x,s.y)<90&&s.shoot()}if(Z("left")&&o.attack_delay<=0){const{x:t,y:e}=R(),{relative_x:i,relative_y:n}=Nt(o.x,o.y,t,e);o.shoot(i,n)}if(pt&&P(pt,s))if(s.alive()){s.lives-=1;let t=a.objects.indexOf(pt);if(t>-1&&a.objects.splice(t,1),pt=null,!s.alive()){let t=a.objects.indexOf(s);t>-1&&a.objects.splice(t,1)}}else{let t=a.objects.indexOf(s);t>-1&&a.objects.splice(t,1)}if(wt&&P(wt,o)){o.lives-=1;let t=a.objects.indexOf(wt);if(t>-1&&a.objects.splice(t,1),wt=null,!o.alive()){let t=a.objects.indexOf(o);t>-1&&a.objects.splice(t,1)}}if(pt&&(pt.y<0||pt.y>jt||pt.x<0||pt.x>Mt)){let t=a.objects.indexOf(pt);t>-1&&a.objects.splice(t,1),pt=null}if(wt&&(wt.y<0||wt.y>jt||wt.x<0||wt.x>Mt)){let t=a.objects.indexOf(wt);t>-1&&a.objects.splice(t,1),wt=null}a.update()},render:function(){a.render()}});k.start()}))})();
/**
 * @preserve
 * Kontra.js v9.0.0
 */